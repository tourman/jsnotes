# Browser Task Observation

## Arrange

### Environment

Google Chrome 122.0.6190.0

### Script

Usage note: just paste it into the browser console.

```js
var stop = false;
var initAt;

function block() {
  const begin = performance.now();
  while (performance.now() < begin + 50) {
    //
  }
}

function schedule() {
  initAt = initAt || performance.now();
  if (performance.now() > initAt + 5000) {
    return;
  }
  if (stop) {
    return;
  }
  block();
  queueMicrotask(schedule);
}

function abort() {
  block();
  stop = true;
}

function animation() {
  block();
}

function channel() {
  block();
}

function timeout() {
  block();
}

var mc = new MessageChannel();
mc.port1.onmessage = channel;

function handleClick() {
  schedule();
  requestAnimationFrame(animation);
  setTimeout(timeout);
  mc.port2.postMessage(null);
  document.removeEventListener('click', handleClick);
}

document.addEventListener('click', handleClick);
document.addEventListener('dblclick', abort);

```

### Actions

1. Open DevTools, choose Performance and click Record.
1. Single-click the document.
1. Wait 2 seconds, then double-click.
1. Stop recording after 10 seconds.
1. Review the results.

## Observation

1. The sequence of the microtasks generated by the `schedule` function is entirely contained within a single task.
2. The `dblclick` event remains inactive throughout the entire sequence.
3. The sequence of tasks, excluding the microtasks, follows the order: `abort` (triggered by the `dblclick` event), `animation`, `timeout`, and `channel`. Consequently, the event is prioritised ahead of all other scheduled tasks.
4. Both the `abort` and `animation` functions are integrated as steps within a unified task.
5. Each of the `timeout` and `channel` functions is associated with a distinct task.

